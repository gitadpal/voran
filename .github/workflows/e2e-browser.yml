name: E2E Browser Spec

run-name: "E2E: ${{ inputs.spec_path || 'specs/lpl-wbg-vs-blg-game1-week1-2026.json' }}"

on:
  workflow_dispatch:
    inputs:
      spec_path:
        description: "Path to spec JSON file (relative to repo root)"
        required: false
        default: "specs/lpl-wbg-vs-blg-game1-week1-2026.json"
        type: string

jobs:
  resolve-browser-spec:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: "20"

      - name: Install dependencies
        run: npm ci

      - name: Install Chromium dependencies
        run: npx puppeteer browsers install chrome

      - name: "Resolve: ${{ inputs.spec_path }}"
        run: |
          npx tsx src/cli/run-resolver.ts "${{ inputs.spec_path }}" > /tmp/result.json

      - name: Show result
        run: |
          echo "=== Signed Payload ==="
          cat /tmp/result.json
          echo ""

          PARSED_VALUE=$(node -e "console.log(JSON.parse(require('fs').readFileSync('/tmp/result.json','utf8')).parsedValue)")
          RESULT=$(node -e "console.log(JSON.parse(require('fs').readFileSync('/tmp/result.json','utf8')).result)")

          echo "parsedValue: $PARSED_VALUE"
          echo "result: $RESULT"

      - uses: actions/upload-artifact@v4
        with:
          name: signed-payload-esports-e2e
          path: |
            /tmp/result.json
            /tmp/voran-browser-screenshot.png
          retention-days: 7
